function draw(){function e(e){return e<=768?"mobile":"desktop"}function t(e){var t={};return"mobile"==e?(t.axisRange=[f,0],t.axisTransform="translate(40,0)",t.forceX=d3.forceX(d/2),t.forceY=t.forceY=d3.forceY(function(e){return c(e.value)}).strength(1),t.maxSize=50):(t.axisRange=[0,d],t.axisTransform="translate(0,"+f+")",t.forceX=d3.forceX(function(e){return c(e.value)}).strength(1),t.forceY=d3.forceY(f/2),t.maxSize=100),t}function n(e){var t=e["2016-17 (RE)"],n=e["2017-18 (BE)"];if(t&&n)return e.value=(n-t)/t,e.pct=e.value,e.size=+n,e.value>1&&(e.value=1),e}function a(e){$("#colors").remove(),$("#legend").append("<div id='colors'></div>"),$("#legend #colors").append("<div class='header'>Colour represents scheme category</div>");var t=_.chain(e).pluck("sub-category").uniq().value();t.forEach(function(e,t){$("#legend #colors").append("<div class='item'><div class='swatch' style='background:"+u(e)+"'></div>"+e+"</div>")})}function i(e){$("#size").remove(),$("#legend").append("<div id='size'></div>"),$("#legend #size").append("<div class='header'>Size represents expenditure estimate, 2017-18</div>"),$("#legend #size").append("<div class='c-wrapper'></div>");var t=[1e3,5e3,1e4];t.forEach(function(e,t){$("#legend #size .c-wrapper").append("<div class='item item-"+t+"'><div class='legend-circle' style='width:"+h(2*e)+"px;height:"+h(2*e)+"px;'></div></div>"),0==t?$("#legend #size .c-wrapper .item-"+t).css("margin-bottom",2*h(e)+"px"):1==t&&$("#legend #size .c-wrapper .item-"+t).css("margin-bottom",h(e/4)+"px")})}var o=[];$("svg").remove();var r=e($(window).width()),s="mobile"==r?window.innerHeight:.8*window.innerHeight,p={top:30,right:"mobile"==r?10:150,bottom:30,left:"mobile"==r?10:150},d=window.innerWidth-p.left-p.right,f=s-p.top-p.bottom,l=t(r),x=d3.select("#viz").append("svg").attr("width",d+p.left+p.right).attr("height",f+p.top+p.bottom),c=(d3.format("%"),d3.scaleLinear().rangeRound(l.axisRange).domain([-.60000000001,1]));l.axis="mobile"==r?d3.axisLeft(c).ticks(20,"%"):d3.axisBottom(c).ticks(20,"%");var h=d3.scaleLinear().range([5,l.maxSize]),u=d3.scaleOrdinal().range(["#334d5c","#45b29b","#df5a49"]),g=x.append("g").attr("transform","translate("+p.left+","+p.top+")"),m=d3.swoopyDrag().x(function(e){return e.x}).y(function(e){return e.y});d3.csv("data.csv",n,function(e,t){function n(e,t){function n(e){var t=e.y,n=$(".tip").height(),a=$("svg").offset().top,i=$(window).scrollTop(),o=h(e.size),r=t-o-n+a-i+10;return r<40?(r=t+o+n/2.7+a-i+10,$(".tip").addClass("bottom").removeClass("top")):$(".tip").addClass("top").removeClass("bottom"),r}function a(e){var t=e.x,n=(h(e.size),$(".tip").width());return t+p.left-n/2}var i=e.data,o=".circle.c-"+t+"-"+strings.toSlugCase(i.scheme);$(".tip").empty(),d3.select(o).moveToFront(),d3.selectAll(".text").moveToFront(),$(".tip").show(),$(".circle").removeClass("highlight"),$(o).addClass("highlight"),$(".tip").append("<div class='name'>"+i.scheme+"</div>"),$(".tip").append("<div class='ministry' style='color:"+u(i["sub-category"])+"'>"+i["sub-category"]+"</div>"),$(".tip").append("<table></table>"),$(".tip table").append("<thead><td>2016-17 (Rs)</td><td>2017-18 (Rs)</td><td>Change</td></thead>"),$(".tip table").append("<tr class='data'><td>"+strings.numberLakhs(i["2016-17 (RE)"])+" cr</td><td>"+strings.numberLakhs(i["2017-18 (BE)"])+" cr</td><td>"+strings.numberDecimals(100*i.pct,2)+"%</td></tr>"),$(".tip").css({top:n(i),left:a(i)}),$(window).resize(function(){$(".tip").css({top:n(i),left:a(i)})})}function s(e){$(".circle").removeClass("highlight")}if(e)throw e;h.domain(d3.extent(t,function(e){return e.size})),u.domain(_.chain(t).pluck("sub-category").uniq().value()),a(t),i(t);for(var v=d3.forceSimulation(t).force("x",l.forceX).force("y",l.forceY).force("collide",d3.forceCollide(function(e,t){return h(e.size)+1})).stop(),y=0;y<250;++y)v.tick();g.append("g").attr("class","axis").attr("transform",l.axisTransform).call(l.axis);var w=g.append("g").attr("class","cells").selectAll("g").data(d3.voronoi().extent([[-p.left,-p.top],[d+p.right,f+p.top]]).x(function(e){return e.x}).y(function(e){return e.y}).polygons(t)).enter().append("g");t.forEach(function(e){if("Mahatma Gandhi National Rural Employment Guarantee Programme (MGNREGS)"==e.scheme){var t={};h(e.size);t.text="MGNREGS",t.path="",t.x=e.x,t.y=e.y,t.textOffset=[0,0],o.push(t)}}),w.append("path").attr("d",function(e){if(void 0!=e)return"M"+e.join("L")+"Z"}),w.append("circle").attr("class",function(e,t){if(void 0!=e)return"circle c-"+t+"-"+strings.toSlugCase(e.data.scheme)}).attr("r",function(e){if(void 0!=e)return h(e.data.size)}).attr("cx",function(e){if(void 0!=e)return e.data.x}).attr("cy",function(e){if(void 0!=e)return e.data.y}).style("fill",function(e){if(void 0!=e)return u(e.data["sub-category"])}),"mobile"==r?(l.noChangeLine_x1=40,l.noChangeLine_x2=d,l.noChangeLine_y1=c(0),l.noChangeLine_y2=c(0),l.noChangeText_x=d,l.noChangeText_y=c(0)-3,l.noChangeText_anchor="end",l.annText_y=0):(l.noChangeLine_x1=c(0),l.noChangeLine_x2=c(0),l.noChangeLine_y1=0,l.noChangeLine_y2=f,l.noChangeText_x=c(0)+3,l.noChangeText_y=f-3,l.noChangeText_anchor="start",l.annText_y=f/2-120),g.append("line").attr("x2",l.noChangeLine_x2).attr("x1",l.noChangeLine_x1).attr("y2",l.noChangeLine_y2).attr("y1",l.noChangeLine_y1).style("stroke-width","2px").style("stroke-dasharray","5px").style("stroke","#888").moveToBack(),g.append("text").attr("x",l.noChangeText_x).attr("y",l.noChangeText_y).text("No change").style("fill","#888").style("text-anchor",l.noChangeText_anchor).style("text-shadow","-1px -1px 1px #f7f7f7, -1px 0px 1px #f7f7f7, -1px 1px 1px #f7f7f7, 0px -1px 1px #f7f7f7, 0px 1px 1px #f7f7f7, 1px -1px 1px #f7f7f7, 1px 0px 1px #f7f7f7, 1px 1px 1px #f7f7f7"),g.append("text").attr("x",0).attr("y",f-3).text("Percent change, 16-17 (RE) to 17-18 (BE)").style("display","mobile"==r?"none":"block").style("fill","#3a403d").style("font-size",".8em").style("text-anchor","start").style("text-shadow","-1px -1px 1px #f7f7f7, -1px 0px 1px #f7f7f7, -1px 1px 1px #f7f7f7, 0px -1px 1px #f7f7f7, 0px 1px 1px #f7f7f7, 1px -1px 1px #f7f7f7, 1px 0px 1px #f7f7f7, 1px 1px 1px #f7f7f7"),g.append("text").attr("x",l.annText_x).attr("y",l.annText_y).style("font-size",".8em").style("fill","#888").style("text-anchor","mobile"==r?"start":"end").style("text-shadow","-1px -1px 1px #f7f7f7, -1px 0px 1px #f7f7f7, -1px 1px 1px #f7f7f7, 0px -1px 1px #f7f7f7, 0px 1px 1px #f7f7f7, 1px -1px 1px #f7f7f7, 1px 0px 1px #f7f7f7, 1px 1px 1px #f7f7f7").tspans(d3.wordwrap("Budgets for these schemes were more than doubled.",15)),m.annotations(o);g.append("g").attr("class","annotation").call(m);d3.selectAll(".annotation text").style("text-anchor","middle"),w.on("mousemove",n).on("mouseout",s),x.on("mouseout",function(){$(".tip").hide()})})}$("#viz").append("<div class='tip'></div>"),$(".tip").hide(),draw(),$(window).smartresize(function(){draw()});